### **Этап 2: Сравнительный анализ производительности PostgreSQL на Windows 11 и Ubuntu 22.04 LTS**  

#### **1. Методология тестирования**  
Для объективного сравнения использовались идентичные параметры тестирования в **HammerDB (TPROC-C)** на двух виртуальных машинах:  
- **Гипервизор:** Parallels Desktop 19.3.0  
- **Архитектура:** ARM64  
- **Конфигурация ВМ:**  
  - **vCPU:** 6 ядер  
  - **RAM:** 16 ГБ (Windows) / 4 ГБ (Ubuntu)  
  - **Диск:** SSD (динамическое выделение)  
  - **PostgreSQL:** версия 16.8  

**Параметры теста:**  
- **Тип теста:** TPROC-C (OLTP-нагрузка)  
- **Виртуальные пользователи (Virtual Users):** 3–4  
- **Время разогрева (Ramp-up):** 120 сек  
- **Длительность теста:** 600 сек (10 мин)  
- **Количество складов (Warehouses):** 10  
- **Think Time:** 5000 мс  

---

#### **2. Результаты тестирования**  

##### **2.1. Ubuntu 22.04 LTS (ARM64)**  
- **TPM (транзакций в минуту):** **183 403**  
- **NOPM (новых заказов в минуту):** **79 805**  
- **Загрузка CPU:** **87.3%** (43.8% user + 43.5% system)  
- **Использование RAM:** **1.7 / 1.9 ГБ (89.4%)**  
- **Дисковая активность (I/O wait):** **6.1%**  

**Топ-процессы:**  
```bash
PID   USER      %CPU  %MEM  COMMAND
10570 postgres  43.8  7.7   postgres: worker process
10607 postgres  43.8  7.7   postgres: worker process 
10665 postgres  37.5  7.7   postgres: checkpointer
```

##### **2.2. Windows 11 (ARM64)**  
- **TPM (транзакций в минуту):** **127 573 – 153 038**  
- **NOPM (новых заказов в минуту):** **55 408 – 68 550**  
- **Загрузка CPU:** **52–56%** (3.20 GHz)  
- **Использование RAM:** **4.3–4.7 / 16 ГБ (27–29%)**  
- **Дисковая активность:** **9–47%** (SSD SATA)  

**Наблюдения:**  
- Windows показывает **меньшую нагрузку на CPU** (56% против 87% в Ubuntu).  
- Ubuntu **эффективнее использует память**, но ближе к пределу (89% против 29% в Windows).  
- **Производительность (TPM) на Ubuntu выше на ~31%**, чем на Windows.  

---

#### **3. Сравнительный анализ**  

| **Параметр**        | **Ubuntu 22.04**   | **Windows 11**    | **Разница**                                       |
| ------------------- | ------------------ | ----------------- | ------------------------------------------------- |
| **TPM (среднее)**   | 183 403            | 140 000           | **+31% (Ubuntu)**                                 |
| **NOPM (среднее)**  | 79 805             | 62 000            | **+29% (Ubuntu)**                                 |
| **CPU Utilization** | 87.3%              | 56%               | **+56% (Ubuntu)**                                 |
| **RAM Usage**       | 1.7 / 1.9 ГБ (89%) | 4.5 / 16 ГБ (28%) | **Windows использует больше RAM**                 |
| **Disk I/O**        | 6.1% (wa)          | 9–47%             | **Windows имеет более высокую дисковую нагрузку** |

**Выводы:**  
1. **Ubuntu показывает лучшую производительность** (на 30% выше TPM), но **сильнее нагружает CPU**.  
2. **Windows стабильнее** в плане нагрузки, но **менее эффективен** в обработке транзакций.  
3. **Ubuntu ближе к пределу RAM**, тогда как Windows использует лишь **28% доступной памяти**.  
4. **Дисковая нагрузка выше на Windows**, что может быть связано с особенностями файловой системы NTFS.  

---

#### **4. Рекомендации по оптимизации**  

##### **Для Ubuntu:**  
✅ **Увеличить RAM** (минимум до 4 ГБ) для избежания swap-использования.  
✅ **Оптимизировать настройки PostgreSQL:**  
```sql
ALTER SYSTEM SET shared_buffers = '2GB';
ALTER SYSTEM SET effective_cache_size = '3GB';
ALTER SYSTEM SET random_page_cost = 1.1;
```
✅ **Настроить swappiness:**  
```bash
echo "vm.swappiness=10" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

##### **Для Windows:**  
✅ **Проверить дисковую подсистему** (возможно, перейти на NVMe).  
✅ **Оптимизировать настройки PostgreSQL** (увеличить `work_mem`).  
✅ **Уменьшить Think Time в HammerDB до 3000 мс** для более агрессивной нагрузки.  

---

#### **5. Итоговый вердикт**  
- **Если нужна максимальная производительность → Ubuntu** (но требуется больше RAM).  
- **Если важна стабильность и предсказуемость → Windows** (но производительность ниже).  
- **Оптимальный вариант:**  
  - Для **высоконагруженных OLTP-систем** лучше **Ubuntu**.  
  - Для **разработки и тестирования** подойдет **Windows**.  

**График сравнения TPM:**  
```
Ubuntu   |==================== 183,403
Windows  |============== 140,000
```

**График загрузки CPU:**  
```
Ubuntu   |==================== 87%
Windows  |============ 56%
```

Таким образом, **Ubuntu выигрывает в производительности**, но требует более тонкой настройки, тогда как **Windows проще в управлении**, но менее эффективен при высокой нагрузке.